<html>
<head>
    <title>TV Hora</title>
    <link rel="icon" href="favico.png">
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css" />
    <script src="com.js"></script>
    <!-- Load external JS file that defines getchannel() -->
    <script src="https://backend-mrdannyarmstrong.github.io/tvhora/v3/cable.js"></script>
    <script>
        onload = function () {
            channels = getchannels();
            cururl = getcurpath();
            var timerID = setInterval(function () {
                maxsize(1);
            }, 60 * 1);

            const video = document.getElementById('video');
            let videoSrc = cururl;

            // If the URL contains joj.sk, rewrite it to use the proxy
            if (videoSrc.includes('joj.sk')) {
                const encodedUrl = encodeURIComponent(videoSrc);
                videoSrc = `https://joj.zababyte2k.workers.dev/?url=${encodedUrl}`;
            }
            if (videoSrc.includes('utako.moe')) {
                const encodedUrl = encodeURIComponent(videoSrc);
                videoSrc = `https://jpntv.zababyte2k.workers.dev/?url=${encodedUrl}`;
            }

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(videoSrc);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, function () {
                    video.play();
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = videoSrc;
                video.addEventListener('loadedmetadata', function () {
                    video.play();
                });
                video.addEventListener('error', function () {
                    alert('connection error');
                });
            } else {
                alert('connection error');
            }
        };
    </script>
</head>
<body class="tvbody">
    <audio id="hoversfx">
        <source src="hover.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio> 
    <video id="video" autoplay controls></video>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</body>
</html>
