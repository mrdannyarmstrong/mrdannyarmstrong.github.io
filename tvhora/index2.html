<html>
<head>
    <title>TV Hora</title>
    <link rel="icon" href="favico.png">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,  user-scalable=0">
	<meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="luna2.css" />
    <script src="com.js"></script>
    <!-- Load external JS file that defines getchannel() -->
    <script src="https://backend-mrdannyarmstrong.github.io/tvhora/v1/back.js"></script>
    <script>
        onload = function () {
            channels = getchannels();
            cururl = getcurpath();
            curpos = getpos(cururl);
            setnav(curpos);
            getdb(curpos);
            var timerID = setInterval(function () {
                maxsize(2);
            }, 60 * 1);

            const video = document.getElementById('video');
            let videoSrc = cururl;

            // If the URL contains joj.sk, rewrite it to use the proxy
            if (videoSrc.includes('joj.sk')) {
                const encodedUrl = encodeURIComponent(videoSrc);
                videoSrc = `https://joj.zababyte2k.workers.dev/?url=${encodedUrl}`;
            }

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(videoSrc);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, function () {
                    video.play();
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = videoSrc;
                video.addEventListener('loadedmetadata', function () {
                    video.play();
                });
                video.addEventListener('error', function () {
                    alert('connection error');
                });
            } else {
                alert('connection error');
            }
            setnav(curpos);
        };
    </script>
</head>
<body style="background-image: url(none); background-color: black;" class="tvbody">
    <video id="video" autoplay controls></video>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</body>
</html>